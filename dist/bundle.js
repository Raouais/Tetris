!function(t){var e={};function i(s){if(e[s])return e[s].exports;var h=e[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)i.d(s,h,function(e){return t[e]}.bind(null,h));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class s{constructor(t,e,i,s){this.name=s,this.body=e,this.blocksize=i,this.ctx=t}setDirection(t){switch(t){case"left":for(let t=0;t<this.body.length;t++)this.body[t][0]--;this.wallTouched(this.body);break;case"up":for(let t=0;t<this.body.length;t++)o.changePiece();this.wallTouched(this.body);break;case"right":for(let t=0;t<this.body.length;t++)this.body[t][0]++;this.wallTouched(this.body);break;case"Upp":for(let t=0;t<this.body.length;t++)this.body[t][1]--;this.wallTouched(this.body);break;case"down":for(let t=0;t<this.body.length;t++)this.body[t][1]++;this.wallTouched(this.body)}}wallTouched(t,e=0,i=this.ctx.canvas.width/this.blocksize-1){let s=!1;const h=this.ctx.canvas.height/this.blocksize;for(let t=0;t<this.body.length;t++)this.body[t][1]>=h&&(s=!0);do{for(let t=0;t<this.body.length;t++)this.body[t][0]++}while(t[0][0]<=e||t[1][0]<=e||t[2][0]<=e||t[3][0]<=e);do{for(let t=0;t<this.body.length;t++)this.body[t][0]--}while(t[0][0]>i||t[1][0]>i||t[2][0]>i||t[3][0]>i);if(s)for(let t=0;t<this.body.length;t++)this.body[t][1]--}setPieceFormat(t){switch(this.name){case"hat":this.setHatFormat(t);break;case"bar":this.setBarFormat(t);break;case"es":this.setEsFormat(t);break;case"esUpside":this.setEsUpFormat(t);break;case"el":this.setElFormat(t);break;case"elUpside":this.setElUpFormat(t)}console.log(t)}setHatFormat(t){switch(t){case 1:this.body[0][0]++,this.body[0][1]--,this.body[2][0]--,this.body[2][1]++,this.body[3][0]++,this.body[3][1]++,this.wallTouched(this.body);break;case 2:this.body[0][0]++,this.body[0][1]++,this.body[2][0]--,this.body[2][1]--,this.body[3][0]--,this.body[3][1]++,this.wallTouched(this.body);break;case 3:this.body[0][0]--,this.body[0][1]++,this.body[2][0]++,this.body[2][1]--,this.body[3][0]--,this.body[3][1]--,this.wallTouched(this.body);break;case 4:this.body[0][0]--,this.body[0][1]--,this.body[2][0]++,this.body[2][1]++,this.body[3][0]++,this.body[3][1]--,this.wallTouched(this.body)}}setBarFormat(t){switch(t){case 2:case 4:this.body[0][0]-=2,this.body[0][1]++,this.body[2][1]--,this.body[1][0]--,this.body[3][0]++,this.body[3][1]-=2,this.wallTouched(this.body);break;case 1:case 3:this.body[0][0]+=2,this.body[0][1]--,this.body[1][0]++,this.body[2][1]++,this.body[3][0]--,this.body[3][1]+=2,this.wallTouched(this.body)}}setElFormat(t){switch(t){case 1:this.body[0][0]+=2,this.body[0][1]+=2,this.body[1][0]++,this.body[1][1]++,this.body[3][0]--,this.body[3][1]++,this.wallTouched(this.body);break;case 2:this.body[0][0]-=2,this.body[0][1]+=2,this.body[1][0]--,this.body[1][1]++,this.body[3][0]--,this.body[3][1]--,this.wallTouched(this.body);break;case 3:this.body[0][0]-=2,this.body[0][1]-=2,this.body[1][0]--,this.body[1][1]--,this.body[3][0]++,this.body[3][1]--,this.wallTouched(this.body);break;case 4:this.body[0][0]+=2,this.body[0][1]-=2,this.body[1][0]++,this.body[1][1]--,this.body[3][0]++,this.body[3][1]++,this.wallTouched(this.body)}}setElUpFormat(t){switch(t){case 1:this.body[0][0]-=2,this.body[0][1]-=2,this.body[1][0]--,this.body[1][1]--,this.body[3][0]--,this.body[3][1]++,this.wallTouched(this.body);break;case 2:this.body[0][0]+=2,this.body[0][1]-=2,this.body[1][0]++,this.body[1][1]--,this.body[3][0]--,this.body[3][1]--,this.wallTouched(this.body);break;case 3:this.body[0][0]+=2,this.body[0][1]+=2,this.body[1][0]++,this.body[1][1]++,this.body[3][0]++,this.body[3][1]--,this.wallTouched(this.body);break;case 4:this.body[0][0]-=2,this.body[0][1]+=2,this.body[1][0]--,this.body[1][1]++,this.body[3][0]++,this.body[3][1]++,this.wallTouched(this.body)}}setEsFormat(t){switch(t){case 1:case 3:this.body[0][0]+=2,this.body[1][0]++,this.body[1][1]++,this.body[3][0]--,this.body[3][1]++,this.wallTouched(this.body);break;case 2:case 4:this.body[0][0]-=2,this.body[1][0]--,this.body[1][1]--,this.body[3][0]++,this.body[3][1]--,this.wallTouched(this.body)}}setEsUpFormat(t){switch(t){case 1:case 3:this.body[0][0]-=2,this.body[1][0]--,this.body[1][1]++,this.body[3][0]++,this.body[3][1]++,this.wallTouched(this.body);break;case 2:case 4:this.body[0][0]+=2,this.body[1][0]++,this.body[1][1]--,this.body[3][0]--,this.body[3][1]--,this.wallTouched(this.body)}}}class h{static drawPiece(t,e,i,s){t.save(),t.fillStyle=e;for(let e of i){const[i,h]=e.slice();t.fillRect(i*s,h*s,s-2,s-2)}t.restore()}static drawPieceInBox(t,e,i,s,h){t.save();let o=0;for(let c=0;c<i.length;c++)c%4==0&&c>0&&o++,t.fillStyle=h[o],t.fillRect(e[c]*s,i[c]*s,s-2,s-2);t.restore()}static nextPiece(t){document.getElementById("nextPiece").className=t}static drawLineAnimation(t,e,i,s){t.save(),t.fillStyle="#ccccb3",t.fillRect(i*s,e*s,s-2,s-2),t.restore()}}const o=new class{constructor(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=325,this.canvas.height=500,this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.blockzise=25,this.delay=100,this.timeOut,this.body,this.piece,this.nextPiece,this.nextColor,this.newDirection="",this.advenceFrequency=0,this.floorTouched=!1,this.pieces=["hat","bar","el","elUpside","es","esUpside","square"],this.pieceColor=["#b30000","#009900","#000000","#e6b800","#008ae6","#e65c00","#cc0052"],this.boxColor=[],this.setTime,this.mainBlocX=[],this.mainBlocY=[],this.lines=0,this.score=0,this.level=0,this.pieceFormatIterator=0,this.next=["el","bar"]}init(){this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.canvas.style.border="5px solid green",document.body.appendChild(this.canvas),this.drawPieces(),this.refreshCanvas()}randNextPiece(){let t=this.getRandomInt(0,this.pieces.length);this.nextPiece=this.pieces[t],this.next[1]=this.next[0],this.next[0]=this.nextPiece}drawPieces(){this.randNextPiece(),this.nextColor=this.pieceColor[this.pieces.indexOf(this.next[1])],this.body=this.setName(this.next[1]),this.piece=new s(this.ctx,this.body,this.blockzise,this.next[1]),h.nextPiece(this.next[0]),this.floorTouched=!1,this.advenceFrequency=0,this.pieceFormatIterator=0}setName(t){let e;switch(t){case"hat":e=[[5,1],[6,1],[7,1],[6,0]];break;case"bar":e=[[5,0],[6,0],[7,0],[8,0]];break;case"el":e=[[6,0],[6,1],[6,2],[7,2]];break;case"elUpside":e=[[6,2],[6,1],[6,0],[7,0]];break;case"es":e=[[5,0],[6,0],[6,1],[7,1]];break;case"esUpside":e=[[7,0],[6,0],[6,1],[5,1]];break;case"square":e=[[6,0],[7,0],[6,1],[7,1]]}return e}changePiece(){this.level>0&&(this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.drawPieces()),this.level=0}refreshCanvas(){if(this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),h.drawPieceInBox(this.ctx,this.mainBlocX,this.mainBlocY,this.blockzise,this.boxColor),h.drawPiece(this.ctx,this.nextColor,this.piece.body,this.blockzise),this.advenceFrequency++,document.getElementById("level").innerHTML=this.level,this.advenceFrequency%5==0&&this.advencePiece(),this.gameOver()?class{static gameOverAfficher(t){t.save(),t.font="bold 30px sans-serif",t.fillStyle="#000",t.strokeStyle="white",t.lineWidth=5,t.strokeText("Game Over",5,35),t.fillText("Game Over",5,35),t.font="bold 30px sans-serif",t.strokeText("Enter pour rejouer",5,65),t.fillText("Enter pour rejouer",5,65),t.restore()}}.gameOverAfficher(this.ctx):this.timeOut=setTimeout(this.refreshCanvas.bind(this),this.delay),this.isFloorTouched()||this.isPieceMainBlockTouched()){this.piecesInsideBox(),this.drawPieces();for(let t=0;t<this.blockzise;t++)this.clearFullLines(t);this.addScore(this.lines),this.lines=0}}getRandomInt(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}advencePiece(){for(let t=0;t<this.body.length;t++)this.body[t][1]++}isFloorTouched(){let t=!1;const e=this.ctx.canvas.height/this.blockzise;for(let i=0;i<this.body.length;i++)this.body[i][1]>=e&&(t=!0);return t}isPieceMainBlockTouched(){let t,e=!1;t=this.body.length>this.mainBlocX.length?this.body.length:this.mainBlocX.length;for(let i=0;i<t;i++)for(let t=0;t<4;t++)this.mainBlocX[i]==this.body[t][0]&&this.mainBlocY[i]==this.body[t][1]&&(e=!0);return e}piecesInsideBox(){let t=0;for(;t<this.body.length;)this.mainBlocX.push(this.body[t][0]),this.mainBlocY.push(this.body[t][1]-1),t++;this.boxColor.push(this.nextColor),this.i++}gameOver(){for(let t=0;t<this.mainBlocY.length;t++)if(-1==this.mainBlocY[t])return clearTimeout(this.timeOut),!0;return!1}clearFullLines(t){let e=0,i=!1;for(let i=0;i<this.mainBlocX.length;i++)this.mainBlocY[i]==t&&e++;for(let s=0;s<this.mainBlocX.length&&e%(this.canvasWidth/this.blockzise)==0;s++)this.mainBlocY[s]==t&&(h.drawLineAnimation(this.ctx,this.mainBlocY[s],this.mainBlocX[s],this.blockzise),this.mainBlocY[s]=-1,window.set,i=!0);i&&(this.lines++,this.levelFunc());for(let s=0;s<e/(this.canvasWidth/this.blockzise);s++)for(let e=0;e<this.mainBlocX.length&&i;e++)-1!=this.mainBlocY[e]&&this.mainBlocY[e]<t&&this.mainBlocY[e]++}addScore(t){let e=document.getElementById("score");switch(t){case 1:this.score+=30;break;case 2:this.score+=90;break;case 3:this.score+=180;break;case 4:this.score+=360}e.innerHTML=this.score}leftSidePieceTouchedMainBlock(){for(let t=0;t<this.mainBlocY.length&&this.mainBlocX.length>=4;t++)for(let e=0;e<this.body.length;e++)this.body[e][0]==this.mainBlocX[t]&&this.body[e][1]==this.mainBlocY[t]&&this.piece.setDirection("right")}rightSidePieceTouchedMainBlock(){for(let t=0;t<this.mainBlocY.length&&this.mainBlocX.length>=4;t++)for(let e=0;e<this.body.length;e++)this.body[e][0]==this.mainBlocX[t]&&this.body[e][1]==this.mainBlocY[t]&&this.piece.setDirection("left")}downSidePieceTouchedMainBlock(){for(let t=0;t<this.mainBlocY.length&&this.mainBlocX.length>=4;t++)for(let e=0;e<this.body.length;e++)this.body[e][0]==this.mainBlocX[t]&&this.body[e][1]==this.mainBlocY[t]&&this.piece.setDirection("Upp")}sidePieceTouchedMainBlock(){for(let t=0;t<this.mainBlocY.length&&this.mainBlocX.length>=4;t++)for(let e=0;e<this.body.length;e++)this.body[e][0]==this.mainBlocX[t]&&this.body[e][1]==this.mainBlocY[t]&&this.piece.wallTouched(this.body,this.mainBlocY,this.mainBlocX)}collision(){for(let t=0;t<this.mainBlocY.length&&this.mainBlocX.length>=4;t++)for(let e=0;e<this.body.length;e++)this.body[e][0]==this.mainBlocX[t]&&(this.body[e][1],this.mainBlocY[t])}levelFunc(){let t=document.getElementById("level");this.score%60==0&&t.innerHTML<this.score&&(this.level=1),t.innerHTML=this.level}};window.onload=()=>{o.init(),document.onkeydown=t=>{let e;const i=t.keyCode;switch(4==o.pieceFormatIterator&&(o.pieceFormatIterator=0),i){case 37:e="left",o.piece.setDirection(e),o.leftSidePieceTouchedMainBlock();break;case 38:e="up",o.piece.setDirection(e);break;case 39:e="right",o.piece.setDirection(e),o.rightSidePieceTouchedMainBlock();break;case 40:e="down",o.piece.setDirection(e),o.downSidePieceTouchedMainBlock();break;case 13:location.reload(),o.refreshCanvas();break;case 32:o.pieceFormatIterator++,o.piece.setPieceFormat(o.pieceFormatIterator),o.collision()}}}}]);